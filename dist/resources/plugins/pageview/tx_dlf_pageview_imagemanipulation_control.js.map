{"version":3,"sources":["plugins/pageview/tx_dlf_pageview_imagemanipulation_control.js"],"names":["dlfViewerImageManipulationControl","options","dic","$","length","attr","dlfUtils","parseDataDic","layers","baseMap_","map","map_","view_","view","anchor_","href","text","title","controlTarget","append","toolContainerEl_","exists","toolContainer","openToolbox","proxy","event","preventDefault","target","hasClass","deactivate","activate","on","FILTERS_DEFAULT_","filters_","extend","filterUpdated_","handler_","webglContext","canvas","getTargetElement","id","undefined","gl","getGL","glif","reset","filter","addFilter","apply","useProgram","hasOwnProperty","click","sliderEls","i","sliderEl","type","getAttribute","value","slider","prototype","when","hide","done","createMap_","show","trigger","addClass","sliderContainer_","createFilters_","postcomposeImageFilter","outerContainer","contrastSlider","createSlider_","v","parseInt","saturationSlider","brightnessSlider","hueSlider","elFilterId","checked","changed","resetBtn","resetFilter","mapEl_","parentElement","ol","Map","controls","interactions","interaction","DragRotate","DragPan","DragZoom","PinchRotate","PinchZoom","MouseWheelZoom","KeyboardPan","KeyboardZoom","DragRotateAndZoom","keyboardEventTarget","document","renderer","adjustViews","sourceView","destMap","rotateDiff","getRotation","getView","resDiff","getResolution","centerDiff","getCenter","zoomTo","getZoom","rotate","adjustViewHandler","un","className","orientation","key","opt_baseValues","opt_title","opt_labelFn","baseMin","baseMax","steps","minValueEl","maxValueEl","startValue","update","ui","layer","element","valueEl","labelValue","style_top","style","top","innerHTML","style_left","left","innerHtml","removeClass","isActive"],"mappings":"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","file":"tx_dlf_pageview_imagemanipulation_control.js","sourcesContent":["/**\n * (c) Kitodo. Key to digital objects e.V. <contact@kitodo.org>\n *\n * This file is part of the Kitodo and TYPO3 projects.\n *\n * @license GNU General Public License version 3 or later.\n * For the full copyright and license information, please read the\n * LICENSE.txt file that was distributed with this source code.\n */\n\n/**\n * Right know the image manipulation uses an own ol.Map object based on a webgl renderer. This is due to the fact\n * that other parts of the viewer application are using vector geometries and ol3 does only support full vector\n * renderering with the canvas and dom renderer yet. In contrast the image manipulation tool is only working\n * with a webgl renderer. Therefore it uses an own ol.Map object which is overlaid and synchronized with the\n * base ol.Map object.\n *\n * @constructor\n * @param {Object=} options Control options.\n * \t\t{Array.<ol.layer.Layer>} layers\n * \t\t{Element} target\n * \t  {ol.View} view\n * \t  {ol.Map} map\n */\ndlfViewerImageManipulationControl = function(options) {\n\n  /**\n   * @type {Object}\n   * @private\n   */\n  this.dic = $('#tx-dlf-tools-imagetools').length > 0 && $('#tx-dlf-tools-imagetools').attr('data-dic') ?\n\t    \tdlfUtils.parseDataDic($('#tx-dlf-tools-imagetools')) :\n\t    \t\t{'imagemanipulation-on':'Activate image manipulation', 'imagemanipulation-off':'Dectivate image manipulation',\n\t\t  \t\t'saturation':'Saturation', 'hue':'Hue', 'brightness': 'Brightness', 'contrast':'Contrast', 'reset': 'Reset',\n\t\t\t\t\t'invert': 'Color inverting'};\n\n  /**\n\t* @type {Array.<ol.layer.Layer>}\n\t* @private\n\t*/\n  this.layers = options.layers;\n\n\t/**\n\t * @type {ol.Map}\n\t * @private\n\t */\n\tthis.baseMap_ = options.map;\n\n\t/**\n\t * @type {ol.Map|undefined}\n\t * @private\n\t */\n\tthis.map_;\n\n\t/**\n\t * @type {ol.View}\n\t * @private\n\t */\n\tthis.view_ = options.view;\n\n  /**\n   * @type {Element}\n   * @private\n   */\n  this.anchor_ = $('<a/>', {\n\t  href: '#image-manipulation',\n\t  text: this.dic['imagemanipulation-on'],\n\t  title: this.dic['imagemanipulation-on']\n  });\n  $(options.controlTarget).append(this.anchor_);\n\n  /**\n   * @type {Element}\n   * @private\n   */\n  this.toolContainerEl_ = dlfUtils.exists(options.toolContainer) ? options.toolContainer: $('.tx-dlf-toolbox')[0];\n\n  //\n  // Append open/close behavior to toolbox\n  //\n  var openToolbox = $.proxy(function(event) {\n\t  event.preventDefault();\n\n\t  if ($(event.target).hasClass('active')){\n\t\t  this.deactivate();\n\t\t  return;\n\t  }\n\n\t  this.activate();\n  }, this);\n  $(this.anchor_).on('click', openToolbox);\n  $(this.anchor_).on('touchstart', openToolbox);\n\n  //\n  // Initialize the filter\n  //\n\tvar FILTERS_DEFAULT_ = {\n\t\t'brightness': 1,\n\t\t'contrast': 1,\n\t\t'hue': 0,\n\t\t'saturation': 0\n\t};\n\n\t/**\n\t * @type {Object}\n\t * @private\n\t */\n\tthis.filters_ = $.extend({}, FILTERS_DEFAULT_);\n\n\t/**\n\t * Is filter updated\n\t * @type {boolean}\n\t * @private\n\t */\n\tthis.filterUpdated_ = false;\n\n\t/**\n\t * @type {Object}\n\t * @private\n\t */\n\tthis.handler_ = {\n\t\t'postcomposeImageFilter': $.proxy(function (event) {\n\t\t\tvar webglContext = event['glContext'],\n\t\t\t\tcanvas = $('#' + this.map_.getTargetElement().id + ' canvas.ol-unselectable')[0];\n\n\t\t\tif (webglContext !== undefined && webglContext !== null) {\n\t\t\t\tvar gl = webglContext.getGL();\n\n\t\t\t\tif (this.filterUpdated_) {\n\n\t\t\t\t\tglif.reset();\n\n\t\t\t\t\tfor (var filter in this.filters_) {\n\t\t\t\t\t\tglif.addFilter(filter, this.filters_[filter]);\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.filterUpdated_ = false;\n\t\t\t\t}\n\n\t\t\t\tglif.apply(gl, canvas);\n\n\t\t\t\t// for showing openlayers that the program changed\n\t\t\t\t// if missing openlayers will produce errors because it\n\t\t\t\t// expected other shaders in the webgl program\n\t\t\t\twebglContext.useProgram(undefined);\n\t\t\t}\n\t\t}, this),\n\t\t'resetFilter': $.proxy(function(event) {\n\n\t\t\t// reset the checked filters\n\t\t\tif (this.filters_.hasOwnProperty('invert')) {\n\t\t\t\t$('#invert-filter').click();\n\t\t\t}\n\t\t\t\n\t\t\t// reset the slider filters\n\t\t\tvar sliderEls = $('.slider.slider-imagemanipulation');\n\t\t\tfor (var i = 0; i < sliderEls.length; i++) {\n\t\t\t\tvar sliderEl = sliderEls[i],\n\t\t\t\t\ttype = sliderEl.getAttribute('data-type'),\n\t\t\t\t\tvalue = FILTERS_DEFAULT_[type];\n\n\t\t\t\t$(sliderEl).slider('value', value);\n\t\t\t};\n\t\t}, this)\n\t}\n};\n\n/**\n * Activates the image manipulation tool\n */\ndlfViewerImageManipulationControl.prototype.activate = function(){\n\n\t//\n\t// Toggle maps\n\t//\n\t$.when($(this.baseMap_.getTargetElement())\n\t\t// fadeOut the base map container\n\t\t.hide())\n\t\t// fadeIn image map container\n\t\t.done($.proxy(function(){\n\t\t\tif (!dlfUtils.exists(this.map_)) {\n\t\t\t\t// create map container and map object if not exists yet\n\t\t\t\tthis.createMap_();\n\t\t\t}\n\n\t\t\t// Show map\n\t\t\t$(this.map_.getTargetElement()).show();\n\n\t\t\t// trigger open event\n\t\t\t$(this).trigger(\"activate-imagemanipulation\", this.map_);\n\t\t}, this));\n\n\t//\n\t// Toggle toolbox controls\n\t//\n\t$(this.anchor_).addClass('active')\n\t\t.text(this.dic['imagemanipulation-off'])\n\t\t.attr('title', this.dic['imagemanipulation-off']);\n\n\tif (!dlfUtils.exists(this.sliderContainer_)) {\n\t\t// in case filter sliders are not initialize yet add them\n\t\tthis.createFilters_();\n\t};\n\t$(this.sliderContainer_).show().addClass('open');\n\n\t// add postcompose listener to layers\n\tif (this.map_ !== undefined)\n\t\tthis.map_.on('postcompose', this.handler_.postcomposeImageFilter);\n};\n\n/**\n * Setup the image manipulation filters + reset functionality\n * @private\n */\ndlfViewerImageManipulationControl.prototype.createFilters_ = function() {\n\n\t// create outer container\n\tvar outerContainer = $('<div class=\"image-manipulation ol-unselectable\"></div>');\n\t$(this.toolContainerEl_).append(outerContainer);\n\n\t/**\n\t * Inner slider container\n\t * @type {Element}\n\t * @private\n\t */\n\tthis.sliderContainer_ = $('<div class=\"slider-container\"></div>');\n\t$(outerContainer).append(this.sliderContainer_);\n\n\t//\n\t// Create sliders for filters and append them to the toolbox\n\t//\n\tvar contrastSlider = this.createSlider_('slider-contrast', 'horizontal', 'contrast',\n\t\t[1, 0, 2, 0.01], this.dic['contrast'], function(v) {\n\t\t\treturn parseInt(v * 100 - 100);\n\t\t}),\n\t\tsaturationSlider = this.createSlider_('slider-saturation', 'horizontal', 'saturation',\n\t\t\t[0, -1, 1, 0.01], this.dic['saturation'], function(v) {\n\t\t\t\treturn parseInt(v * 100);\n\t\t\t}),\n\t\tbrightnessSlider = this.createSlider_('slider-brightness', 'horizontal', 'brightness',\n\t\t\t[1, 0, 2, 0.1], this.dic['brightness'],function(v) {\n\t\t\t\treturn parseInt(v * 100 - 100);\n\t\t\t}),\n\t\thueSlider = this.createSlider_('slider-hue', 'horizontal', 'hue',\n\t\t\t[0, -180, 180, 5], this.dic['hue'], function(v) {\n\t\t\t\treturn parseInt(v);\n\t\t\t});\n\t$(this.sliderContainer_).append(contrastSlider);\n\t$(this.sliderContainer_).append(saturationSlider);\n\t$(this.sliderContainer_).append(brightnessSlider);\n\t$(this.sliderContainer_).append(hueSlider);\n\n\t// add invert filter\n\tvar elFilterId = 'invert-filter';\n\t$(this.sliderContainer_).append($('<div class=\"checkbox\"><label><input type=\"checkbox\" id=\"' + elFilterId + '\">' +\n\t\t this.dic['invert'] + '</label></div>'));\n\t$('#' + elFilterId).on('click', $.proxy(function(event) {\n\t\tif (event.target.checked === true && !this.filters_.hasOwnProperty('invert')) {\n\t\t\t// if checked add the invert filter to the filters\n\t\t\tthis.filters_['invert'] = true;\n\t\t} else {\n\t\t\t// remove invert filter\n\t\t\tif (this.filters_.hasOwnProperty('invert')) {\n\t\t\t\tdelete this.filters_['invert'];\n\t\t\t}\n\t\t}\n\n\t\t// update filter chain\n\t\tthis.filterUpdated_ = true;\n\t\tthis.layers[0].changed();\n\t}, this));\n\n\t// button for reset to default state\n\tvar resetBtn = $('<button class=\"reset-btn\" title=\"' + this.dic['reset'] + '\">' + this.dic['reset'] + '</button>');\n\t$(this.sliderContainer_).append(resetBtn);\n\t$(resetBtn).on('click', this.handler_.resetFilter);\n};\n\n/**\n * Setup the map object used from the image manipulation tool and bind it to the baseMap\n * @private\n */\ndlfViewerImageManipulationControl.prototype.createMap_ = function() {\n\tvar mapEl_ = $('<div id=\"tx-dfgviewer-map-manipulate\" class=\"tx-dlf-map\"></div>');\n\t$(this.baseMap_.getTargetElement().parentElement).append(mapEl_);\n\n\tthis.map_ = new ol.Map({\n\t\tlayers: this.layers,\n\t\ttarget: mapEl_[0].id,\n\t\tcontrols: [],\n\t\tinteractions: [\n\t\t\tnew ol.interaction.DragRotate(),\n\t\t\tnew ol.interaction.DragPan(),\n\t\t\tnew ol.interaction.DragZoom(),\n\t\t\tnew ol.interaction.PinchRotate(),\n\t\t\tnew ol.interaction.PinchZoom(),\n\t\t\tnew ol.interaction.MouseWheelZoom(),\n\t\t\tnew ol.interaction.KeyboardPan(),\n\t\t\tnew ol.interaction.KeyboardZoom,\n\t\t\tnew ol.interaction.DragRotateAndZoom()\n\t\t],\n\t\t// necessary for proper working of the keyboard events\n\t\tkeyboardEventTarget: document,\n\t\tview: this.view_,\n\t\trenderer: 'webgl'\n\t});\n\n\t// couple map behavior with baseMap\n\tvar adjustViews = function(sourceView, destMap) {\n\t\t\tvar rotateDiff = sourceView.getRotation() !== destMap.getView().getRotation();\n\t\t\tvar resDiff = sourceView.getResolution() !== destMap.getView().getResolution();\n\t\t\tvar centerDiff = sourceView.getCenter() !== destMap.getView().getCenter();\n\n\t\t\tif (rotateDiff || resDiff || centerDiff) {\n\t\t\t\tdestMap.zoomTo(sourceView.getCenter(),\n\t\t\t\t\tsourceView.getZoom(), 50);\n\t\t\t\tdestMap.getView().rotate(sourceView.getRotation());\n\t\t\t}\n\n\t\t},\n\t\tadjustViewHandler = function(event) {\n\t\t\tadjustViews(event.target, this);\n\t\t};\n\n\t// when deactivate / activate adjust both map centers / zoom\n\t$(this).on(\"activate-imagemanipulation\", $.proxy(function(event, map) {\n\t\t// pass change events for resolution and rotation to image manipulation map\n\t\t// created through external view controls\n\t\tthis.baseMap_.getView().on('change:resolution', adjustViewHandler, this.map_);\n\t\tthis.baseMap_.getView().on('change:rotation', adjustViewHandler, this.map_);\n\n\t\t// adjust the view of both maps\n\t\tadjustViews(this.baseMap_.getView(), this.map_);\n\t}, this));\n\t$(this).on(\"deactivate-imagemanipulation\", $.proxy(function(event, map) {\n\t\t// pass change events for resolution and rotation to image manipulation map\n\t\t// created through external view controls\n\t\tthis.baseMap_.getView().un('change:resolution', adjustViewHandler, this.map_);\n\t\tthis.baseMap_.getView().un('change:rotation', adjustViewHandler, this.map_);\n\n\t\t// adjust the view of both maps\n\t\tadjustViews(this.map_.getView(), this.baseMap_);\n\t}, this));\n};\n\n/**\n * Functions creates a slider + behavior.\n *\n * @param {string} className\n * @param {string} orientation\n * @param {string} key\n * @param {Array.<number>|undefined} opt_baseValue\n * @param {string=} opt_title\n * @param {Function=} opt_labelFn\n * @return {Element}\n * @private\n */\ndlfViewerImageManipulationControl.prototype.createSlider_ = function(className, orientation, key, opt_baseValues, opt_title, opt_labelFn){\n\tvar title = dlfUtils.exists('opt_title') ? opt_title : '',\n\t\tsliderEl = $('<div class=\"slider slider-imagemanipulation ' + className + '\" title=\"' + title + '\" data-type=\"' +\n\t\t\tkey +'\"></div>'),\n\t\tbaseMin = dlfUtils.exists(opt_baseValues) ? opt_baseValues[1] : 0,\n\t\tbaseMax = dlfUtils.exists(opt_baseValues) ? opt_baseValues[2] : 100,\n\t\tsteps = dlfUtils.exists(opt_baseValues) ? opt_baseValues[3] : 1,\n\t\tminValueEl,\n\t\tmaxValueEl,\n\t\tstartValue = dlfUtils.exists(opt_baseValues) ? opt_baseValues[0] : 100;\n\n\t/**\n\t * @param {Object} event\n\t * @param {Object} ui\n\t */\n\tvar update = $.proxy(function(event, ui){\n\t\tvar value = ui['value'],\n\t\t\t\tlayer = this.layers[0],\n\t\t\t\telement = valueEl[0],\n\t\t\t\tlabelValue = dlfUtils.exists(opt_labelFn) ? opt_labelFn(value) : value + '%';\n\n\t\tif (orientation == 'vertical') {\n\t\t\tvar style_top = 100 - ((value - baseMin) / (baseMax - baseMin) * 100);\n\t\t\telement.style.top = style_top + '%';\n\t\t\telement.innerHTML = labelValue;\n\t\t\treturn;\n\t\t}\n\n\t\tvar style_left = (value - baseMin) / (baseMax - baseMin) * 100;\n\t\telement.style.left = style_left + '%';\n\t\telement.innerHTML = labelValue;\n\n\t\t// update filters.\n\t\tthis.filters_[key] = value;\n\t\tthis.filterUpdated_ = true;\n\t\tlayer.changed();\n\t}, this);\n\n\t$(sliderEl).slider({\n        'min': baseMin,\n        'max': baseMax,\n        'value': startValue,\n        'animate': 'slow',\n        'orientation': orientation,\n        'step': steps,\n        'slide': update,\n        'change': update\n    });\n\n\t// append tooltips\n\tvar innerHtml = dlfUtils.exists(opt_labelFn) && dlfUtils.exists(opt_baseValues) ? opt_labelFn(opt_baseValues[0]) : '100%',\n\t\t\tvalueEl = $('<div class=\"tooltip value ' + className + '\">' + innerHtml + '</div>');\n\t$(sliderEl).append(valueEl);\n\n\treturn sliderEl;\n};\n\n/**\n * Deactivates the image manipulation control\n */\ndlfViewerImageManipulationControl.prototype.deactivate = function(){\n\n\t// toggle maps\n\tif (dlfUtils.exists(this.map_)) {\n\t\t$(this.map_.getTargetElement()).hide();\n\t}\n\t$(this.baseMap_.getTargetElement()).show();\n\n\t// toggle view of image manipulation control element\n\t$(this.anchor_).removeClass('active')\n\t\t.text(this.dic['imagemanipulation-on'])\n\t\t.attr('title', this.dic['imagemanipulation-on']);\n\n\t$(this.sliderContainer_).hide().removeClass('open');\n\n\t// remove postcompose listener to map\n\tif (this.map_ !== undefined)\n\t\tthis.map_.un('postcompose', this.handler_.postcomposeImageFilter);\n\n\t// trigger close event for trigger map adjust behavior\n\t$(this).trigger(\"deactivate-imagemanipulation\");\n};\n\n/**\n * Function checks if the image manipulation is in active state or not.\n *\n * @return {boolean}\n */\ndlfViewerImageManipulationControl.prototype.isActive = function() {\n\treturn $(this.anchor_).hasClass('active');\n};"],"sourceRoot":"/home/christopher/IdeaProjects/kitodo-presentation/es6"}