{"version":3,"sources":["plugins/pageview/tx_dlf_pageview.js"],"names":["dlfViewer","settings","div","dlfUtils","exists","map","imageUrls","images","fulltexts","highlightFields","highlightFieldParams","undefined","imageManipulationControl","useInternalProxy","init","controls","prototype","addCustomControls","controlNames","fulltextControl","url","length","dlfViewerFullTextControl","$","remove","isWebGLEnabled","isCorsEnabled","dlfViewerImageManipulationControl","controlTarget","layers","createOl3Layers","view","createOl3View","on","proxy","deactivate","addClass","addHighlightField","highlightField","imageIndex","width","height","push","index","displayHighlightWord","createControls_","i","ol","control","OverviewMap","Zoom","highlightLayer","layer","Vector","source","dlfViewerOL3Styles","wordStyle","addLayer","getSource","clear","field","coordinates","offset","feature","scaleToImageSize","Feature","geom","Polygon","addFeatures","key","urlParams","getUrlParams","hasOwnProperty","value","values","split","fulltextData","fetchFulltextDataFromServer","fulltextDataImageTwo","image","extend","stringFeatures","getStringFeatures","concat","forEach","features","searchFeatureCollectionForText","Error","initLayer","done","Map","target","interactions","interaction","DragRotate","DragPan","DragZoom","PinchRotate","PinchZoom","MouseWheelZoom","KeyboardPan","KeyboardZoom","DragRotateAndZoom","keyboardEventTarget","document","renderer","lon","getCookie","lat","zoom","isNullEmptyUndefinedOrNoNumber","center","getView","getCenter","zoomTo","window","trigger","unload","isActive","getZoom","setCookie","imageSourceObjs","deferredResponse","Deferred","resolveCallback","imageSourceData","resolve","origin","fetchImageData"],"mappings":"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","file":"tx_dlf_pageview.js","sourcesContent":["/**\n * (c) Kitodo. Key to digital objects e.V. <contact@kitodo.org>\n *\n * This file is part of the Kitodo and TYPO3 projects.\n *\n * @license GNU General Public License version 3 or later.\n * For the full copyright and license information, please read the\n * LICENSE.txt file that was distributed with this source code.\n */\n\n/**\n * @TODO Trigger resize map event after fullscreen is toggled\n * @param {Object} settings\n *      {string=} div\n *      {Array.<?>} images\n *      {Array.<?>} fulltexts\n *      {Array.<?>} controls\n * @constructor\n */\nvar dlfViewer = function(settings){\n\n    /**\n     * The element id of the map container\n     * @type {string}\n     * @private\n     */\n    this.div = dlfUtils.exists(settings.div) ? settings.div : \"tx-dlf-map\";\n\n    /**\n     * Openlayers map object\n     * @type {ol.Map|null}\n     * @private\n     */\n    this.map = null;\n\n    /**\n     * Contains image information (e.g. URL, width, height)\n     * @type {Array.<string>}\n     * @private\n     */\n    this.imageUrls = dlfUtils.exists(settings.images) ? settings.images : [];\n\n    /**\n     * Contains image information (e.g. URL, width, height)\n     * @type {Array.<{src: *, width: *, height: *}>}\n     * @private\n     */\n    this.images = [];\n\n    /**\n     * Fulltext information (e.g. URL)\n     * @type {Array.<string|?>}\n     * @private\n     */\n    this.fulltexts = dlfUtils.exists(settings.fulltexts) ? settings.fulltexts : [];\n\n    /**\n     * @type {Array.<number>}\n     * @private\n     */\n    this.highlightFields = [];\n\n    /**\n     * @type {Object|undefined}\n     * @private\n     */\n    this.highlightFieldParams = undefined;\n\n    /**\n     * @type {Object|undefined}\n     * @private\n     */\n    this.imageManipulationControl = undefined;\n\n    /**\n     * use internal proxy setting\n     * @type {boolean}\n     * @private\n     */\n    this.useInternalProxy = dlfUtils.exists(settings.useInternalProxy) ? settings.useInternalProxy : false;\n\n    this.init(dlfUtils.exists(settings.controls) ? settings.controls : []);\n};\n\n/**\n * Methods inits and binds the custom controls to the dlfViewer. Right now that are the\n * fulltext and the image manipulation control\n *\n * @param {Array.<string>} controlNames\n */\ndlfViewer.prototype.addCustomControls = function(controlNames) {\n\tvar fulltextControl = undefined,\n\t\timageManipulationControl = undefined,\n\t\timages = this.images;\n\n    // Adds fulltext behavior only if there is fulltext available and no double page\n    // behavior is active\n    if (this.fulltexts[0] !== undefined && this.fulltexts[0].url !== '' && this.images.length == 1) {\n        fulltextControl = new dlfViewerFullTextControl(this.map, this.images[0], this.fulltexts[0].url);\n    } else {\n        $('#tx-dlf-tools-fulltext').remove();\n    }\n\n\n    //\n    // Add image manipulation tool if container is added.\n    //\n    // It is important to know that the image manipulation tool uses a webgl renderer as basis. Therefor the\n    // application has as first to check if the renderer is active. Further it has to check if cors supported through\n    // image.\n    //\n    if ($('#tx-dlf-tools-imagetools').length > 0 && dlfUtils.isWebGLEnabled() && this.isCorsEnabled) {\n\n        // should be called if cors is enabled\n        imageManipulationControl = new dlfViewerImageManipulationControl({\n            controlTarget: $('.tx-dlf-tools-imagetools')[0],\n            layers: dlfUtils.createOl3Layers(images, '*'),\n            map: this.map,\n            view: dlfUtils.createOl3View(images)\n        });\n\n        // bind behavior of both together\n        if (imageManipulationControl !== undefined && fulltextControl !== undefined) {\n            $(imageManipulationControl).on(\"activate-imagemanipulation\", $.proxy(fulltextControl.deactivate, fulltextControl));\n            $(fulltextControl).on(\"activate-fulltext\", $.proxy(imageManipulationControl.deactivate, imageManipulationControl));\n        }\n\n        // set on object scope\n        this.imageManipulationControl = imageManipulationControl;\n\n    } else if ($('#tx-dlf-tools-imagetools').length > 0) {\n\n        // hide the element because the functionality is not supported through missing webgl or cors support.\n        $('#tx-dlf-tools-imagetools').addClass('deactivate');\n\n    }\n};\n\n/**\n * Add highlight field\n *\n * @param {Array.<number>} highlightField\n * @param {number} imageIndex\n * @param {number} width\n * @param {number} height\n *\n * @return\tvoid\n */\ndlfViewer.prototype.addHighlightField = function(highlightField, imageIndex, width, height) {\n\n    this.highlightFields.push(highlightField);\n\n    this.highlightFieldParams = {\n        index: imageIndex,\n        width: width,\n        height: height\n    };\n\n    if (this.map)\n        this.displayHighlightWord();\n};\n\n/**\n * Creates OL3 controls\n * @param {Array.<string>} controlNames\n * @param {Array.<ol.layer.Layer> layers\n * @return {Array.<ol.control.Control>}\n * @private\n */\ndlfViewer.prototype.createControls_ = function(controlNames, layers) {\n\n    var controls = [];\n\n    for (var i in controlNames) {\n\n        if (controlNames[i] !== \"\") {\n\n            switch(controlNames[i]) {\n\n                case \"OverviewMap\":\n\n                    controls.push(new ol.control.OverviewMap({\n                        layers: layers\n                    }));\n                    break;\n\n                case \"ZoomPanel\":\n\n                    controls.push(new ol.control.Zoom());\n                    break;\n\n                default:\n\n                    break;\n\n            }\n        }\n    }\n\n    return controls;\n};\n\n/**\n * Displayes highlight words\n */\ndlfViewer.prototype.displayHighlightWord = function() {\n\n    if (!dlfUtils.exists(this.highlightLayer)) {\n\n        this.highlightLayer = new ol.layer.Vector({\n            'source': new ol.source.Vector(),\n            'style': dlfViewerOL3Styles.wordStyle\n        });\n\n        this.map.addLayer(this.highlightLayer);\n    }\n\n    // check if highlight by coords should be activate\n    if (this.highlightFields.length > 0) {\n        // clear in case of old displays\n        this.highlightLayer.getSource().clear();\n\n        // create features and scale it down\n        for (var i = 0; i < this.highlightFields.length; i++) {\n\n            var field = this.highlightFields[i],\n              coordinates = [[\n                  [field[0], field[1]],\n                  [field[2], field[1]],\n                  [field[2], field[3]],\n                  [field[0], field[3]],\n                  [field[0], field[1]],\n              ]],\n              offset = this.highlightFieldParams.index === 1 ? this.images[0].width : 0;\n            var feature = dlfUtils.scaleToImageSize([new ol.Feature(new ol.geom.Polygon(coordinates))],\n              this.images[this.highlightFieldParams.index],\n              this.highlightFieldParams.width,\n              this.highlightFieldParams.height,\n              offset);\n\n            // add feature to layer and map\n            this.highlightLayer.getSource().addFeatures(feature);\n        }\n    }\n\n    // check if highlight by words is set\n    var key = 'tx_dlf[highlight_word]',\n        urlParams = dlfUtils.getUrlParams();\n\n    if (urlParams != undefined && urlParams.hasOwnProperty(key) && this.fulltexts[0] !== undefined && this.fulltexts[0].url !== '' && this.images.length > 0) {\n        var value = urlParams[key],\n            values = value.split(';'),\n            fulltextData = dlfViewerFullTextControl.fetchFulltextDataFromServer(this.fulltexts[0].url, this.images[0]),\n            fulltextDataImageTwo = undefined;\n\n        // check if there is another image / fulltext to look for\n        if (this.images.length == 2 & this.fulltexts[1] !== undefined && this.fulltexts[1].url !== '') {\n            var image = $.extend({}, this.images[1]);\n            image.width = image.width + this.images[0].width;\n            fulltextDataImageTwo = dlfViewerFullTextControl.fetchFulltextDataFromServer(this.fulltexts[1].url, this.images[1], this.images[0].width)\n        }\n\n        var stringFeatures = fulltextDataImageTwo === undefined ? fulltextData.getStringFeatures() :\n          fulltextData.getStringFeatures().concat(fulltextDataImageTwo.getStringFeatures());\n        values.forEach($.proxy(function(value) {\n            var features = dlfUtils.searchFeatureCollectionForText(stringFeatures, value);\n            if (features !== undefined) {\n                for (var i = 0; i < features.length; i++) {\n                    this.highlightLayer.getSource().addFeatures([features[i]]);\n                }\n            };\n        }, this));\n    };\n};\n\n/**\n * Start the init process of loading the map, etc.\n *\n * @param {Array.<string>} controlNames\n * @private\n */\ndlfViewer.prototype.init = function(controlNames) {\n\n    if (this.imageUrls.length <= 0)\n        throw new Error('Missing image source objects.');\n\n    /**\n     * Is cors enabled. Important information for correct renderer and layer initialization\n     * @type {boolean}\n     */\n     if (this.useInternalProxy) {\n       this.isCorsEnabled = true;\n     } else {\n       this.isCorsEnabled = dlfUtils.isCorsEnabled(this.imageUrls);\n     }\n\n    this.initLayer(this.imageUrls, this.isCorsEnabled)\n        .done($.proxy(function(layers){\n\n            var controls = controlNames.length > 0 || controlNames[0] === \"\"\n                ? this.createControls_(controlNames, layers)\n                : [];\n                //: [ new ol.control.MousePosition({\n                //        coordinateFormat: ol.coordinate.createStringXY(4),\n                //        undefinedHTML: '&nbsp;'\n                //    })];\n\n            // create map\n            this.map = new ol.Map({\n                layers: layers,\n                target: this.div,\n                controls: controls,\n                interactions: [\n                    new ol.interaction.DragRotate(),\n                    new ol.interaction.DragPan(),\n                    new ol.interaction.DragZoom(),\n                    new ol.interaction.PinchRotate(),\n                    new ol.interaction.PinchZoom(),\n                    new ol.interaction.MouseWheelZoom(),\n                    new ol.interaction.KeyboardPan(),\n                    new ol.interaction.KeyboardZoom,\n                    new ol.interaction.DragRotateAndZoom()\n                ],\n                // necessary for proper working of the keyboard events\n                keyboardEventTarget: document,\n                view: dlfUtils.createOl3View(this.images),\n                renderer: 'canvas'\n            });\n\n            // Position image according to user preferences\n            var lon = dlfUtils.getCookie(\"tx-dlf-pageview-centerLon\"),\n              lat = dlfUtils.getCookie(\"tx-dlf-pageview-centerLat\"),\n              zoom = dlfUtils.getCookie(\"tx-dlf-pageview-zoomLevel\");\n            if (!dlfUtils.isNullEmptyUndefinedOrNoNumber(lon) && !dlfUtils.isNullEmptyUndefinedOrNoNumber(lat) && !dlfUtils.isNullEmptyUndefinedOrNoNumber(zoom)) {\n                // make sure, zoom center is on viewport\n                var center = this.map.getView().getCenter();\n                if ((lon < (2.2 * center[0])) && (lat < (2.2 * center[1]))) {\n                    this.map.zoomTo([lon, lat], zoom);\n                }\n            }\n\n            // highlight word in case a highlight field is registered\n            this.displayHighlightWord();\n\n            this.addCustomControls(controls);\n\n            // trigger event after all has been initialize\n            $(window).trigger(\"map-loadend\", window);\n\n            // append listener for saving view params in case of flipping pages\n            $(window).unload($.proxy(function() {\n                // check if image manipulation control exists and if yes deactivate it first for proper recognition of\n                // the actual map view\n                if (this.imageManipulationControl !== undefined && this.imageManipulationControl.isActive()) {\n                    this.imageManipulationControl.deactivate();\n                }\n\n                var zoom = this.map.getZoom() !== undefined ? this.map.getZoom() : '',\n                    center = this.map.getView().getCenter() !== undefined ? this.map.getView().getCenter() : ['', ''];\n\n                // save actual map view parameters to cookie\n                dlfUtils.setCookie('tx-dlf-pageview-zoomLevel', zoom);\n                dlfUtils.setCookie('tx-dlf-pageview-centerLon', center[0]);\n                dlfUtils.setCookie('tx-dlf-pageview-centerLat', center[1]);\n            }, this));\n        }, this));\n\n};\n\n/**\n * Function generate the ol3 layer objects for given image sources. Returns a promise.\n *\n * @param {Array.<{url: *, mimetype: *}>} imageSourceObjs\n * @param {boolean} isCorsEnabled\n * @return {jQuery.Deferred.<function(Array.<ol.layer.Layer>)>}\n * @private\n */\ndlfViewer.prototype.initLayer = function(imageSourceObjs, isCorsEnabled) {\n\n    // use deferred for async behavior\n    var deferredResponse = new $.Deferred(),\n      /**\n       * @param {Array.<{src: *, width: *, height: *}>} imageSourceData\n       * @param {Array.<ol.layer.Layer>} layers\n       */\n      resolveCallback = $.proxy(function(imageSourceData, layers) {\n            this.images = imageSourceData;\n            deferredResponse.resolve(layers);\n        }, this),\n      origin = isCorsEnabled ? '*' : undefined;\n\n    dlfUtils.fetchImageData(imageSourceObjs)\n      .done(function(imageSourceData) {\n          resolveCallback(imageSourceData, dlfUtils.createOl3Layers(imageSourceData, origin));\n      });\n\n    return deferredResponse;\n};\n"],"sourceRoot":"/home/christopher/IdeaProjects/kitodo-presentation/es6"}