{"version":3,"sources":["plugins/pageview/tx_dlf_pageview_fulltext_control.js"],"names":["jQuery","fn","scrollTo","elem","speed","manualOffsetTop","$","parent","height","animate","scrollTop","offset","top","undefined","dlfViewerFullTextControl","map","image","fulltextUrl","url","dic","length","attr","dlfUtils","parseDataDic","fulltextData_","layers_","textblock","ol","layer","Vector","source","dlfViewerOL3Styles","defaultStyle","textline","invisibleStyle","select","selectStyle","hoverTextblock","hoverStyle","hoverTextline","textlineStyle","selectedFeature_","handlers_","mapClick","proxy","event","feature","forEachFeatureAtPixel","get","getSource","clear","showFulltext","removeFeature","addFeature","exists","mapHover","hoverSourceTextblock_","hoverSourceTextline_","selectSource_","map_","textblockFeature","textlineFeature","activeSelectTextBlockEl_","getFeatures","activeHoverTextBlockEl_","isFeatureEqualSelectFeature_","getId","isFeatureEqualToOldHoverFeature_","oldTargetElem","hasClass","removeClass","targetElem","addClass","anchorEl","toogleFulltext","preventDefault","target","deactivate","activate","on","text","getCookie","prototype","controlEl","fetchFulltextDataFromServer","addFeatures","getTextblocks","getTextlines","enableFulltextSelect","setCookie","trigger","disableFulltextSelect","un","key","hasOwnProperty","removeLayer","className","hide","textBlockFeatures","textLineFeatures","addLayer","show","opt_offset","request","ajax","async","parser","dlfAltoParser","fulltextCoordinates","responseXML","parseFeatures","responseText","features","popupHTML","appendHTML","html","textlines","i","content","j","replace"],"mappings":"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","file":"tx_dlf_pageview_fulltext_control.js","sourcesContent":["/**\n * (c) Kitodo. Key to digital objects e.V. <contact@kitodo.org>\n *\n * This file is part of the Kitodo and TYPO3 projects.\n *\n * @license GNU General Public License version 3 or later.\n * For the full copyright and license information, please read the\n * LICENSE.txt file that was distributed with this source code.\n */\n\n/**\n * This is necessary to support the scrolling of the element into the viewport\n * in case of text hover on the map.\n *\n * @param elem\n * @param speed\n * @returns {jQuery}\n */\njQuery.fn.scrollTo = function(elem, speed) {\n    var manualOffsetTop = $(elem).parent().height() / 2;\n    $(this).animate({\n        scrollTop:  $(this).scrollTop() - $(this).offset().top + $(elem).offset().top - manualOffsetTop\n    }, speed == undefined ? 1000 : speed);\n    return this;\n};\n\n/**\n * Encapsulates especially the fulltext behavior\n * @constructor\n * @param {ol.Map} map\n * @param {Object} image\n * @param {string} fulltextUrl\n */\nvar dlfViewerFullTextControl = function(map, image, fulltextUrl) {\n\n    /**\n     * @private\n     * @type {ol.Map}\n     */\n    this.map = map;\n\n    /**\n     * @type {Object}\n     * @private\n     */\n    this.image = image;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.url = fulltextUrl;\n\n    /**\n     * @type {Object}\n     * @private\n     */\n    this.dic = $('#tx-dlf-tools-fulltext').length > 0 && $('#tx-dlf-tools-fulltext').attr('data-dic') ?\n    \tdlfUtils.parseDataDic($('#tx-dlf-tools-fulltext')) :\n    \t{'fulltext-on':'Activate Fulltext','fulltext-off':'Dectivate Fulltext'};\n\n    /**\n     * @type {ol.Feature|undefined}\n     * @private\n     */\n    this.fulltextData_ = undefined;\n\n    /**\n     * @type {Object}\n     * @private\n     */\n    this.layers_ = {\n        textblock: new ol.layer.Vector({\n            'source': new ol.source.Vector(),\n            'style': dlfViewerOL3Styles.defaultStyle()\n        }),\n        textline: new ol.layer.Vector({\n            'source': new ol.source.Vector(),\n            'style': dlfViewerOL3Styles.invisibleStyle()\n        }),\n        select: new ol.layer.Vector({\n            'source': new ol.source.Vector(),\n            'style': dlfViewerOL3Styles.selectStyle()\n        }),\n        hoverTextblock: new ol.layer.Vector({\n            'source': new ol.source.Vector(),\n            'style': dlfViewerOL3Styles.hoverStyle()\n        }),\n        hoverTextline: new ol.layer.Vector({\n            'source': new ol.source.Vector(),\n            'style': dlfViewerOL3Styles.textlineStyle()\n        })\n    };\n\n    /**\n     * @type {ol.Feature}\n     * @private\n     */\n    this.selectedFeature_;\n\n    /**\n     * @type {Object}\n     * @private\n     */\n    this.handlers_ = {\n        mapClick: $.proxy(function(event) {\n                // the click handler adds the clicked feature to a\n                // select layer which could be used to create a highlight\n                // effect on the map\n\n                var feature = this.map.forEachFeatureAtPixel(event['pixel'], function(feature, layer) {\n                    if (feature.get('type') === 'textblock')\n                        return feature;\n                });\n\n                // deselect all\n                if (feature === undefined) {\n                    this.layers_.select.getSource().clear();\n                    this.selectedFeature_ = undefined;\n                    this.showFulltext(undefined);\n                    return;\n                };\n\n                // highlight features\n                if (this.selectedFeature_ ) {\n\n                    // remove old clicks\n                    this.layers_.select.getSource().removeFeature(this.selectedFeature_);\n\n                }\n\n                if (feature) {\n\n                    // remove hover for preventing an adding of styles\n                    this.layers_.hoverTextblock.getSource().clear();\n\n                    // add feature\n                    this.layers_.select.getSource().addFeature(feature);\n\n                }\n\n                this.selectedFeature_ = feature;\n\n\n                if (dlfUtils.exists(feature))\n                    this.showFulltext([feature]);\n\n            },\n        this),\n        mapHover: $.proxy(function(event) {\n                // hover in case of dragging\n                if (event['dragging']) {\n                    return;\n                };\n\n                var hoverSourceTextblock_ = this.layers_.hoverTextblock.getSource(),\n                    hoverSourceTextline_ = this.layers_.hoverTextline.getSource(),\n                    selectSource_ = this.layers_.select.getSource(),\n                    map_ = this.map,\n                    textblockFeature,\n                    textlineFeature;\n\n                map_.forEachFeatureAtPixel(event['pixel'], function(feature, layer) {\n                    if (feature.get('type') === 'textblock')\n                        textblockFeature = feature;\n                    if (feature.get('type') === 'textline')\n                        textlineFeature = feature;\n                });\n\n                //\n                // Handle TextBlock elements\n                //\n                var activeSelectTextBlockEl_ = selectSource_.getFeatures().length > 0 ?\n                        selectSource_.getFeatures()[0] : undefined,\n                    activeHoverTextBlockEl_ = hoverSourceTextblock_.getFeatures().length > 0 ?\n                        hoverSourceTextblock_.getFeatures()[0] : undefined,\n                    isFeatureEqualSelectFeature_ = activeSelectTextBlockEl_ !== undefined && textblockFeature !== undefined &&\n                    activeSelectTextBlockEl_.getId() === textblockFeature.getId() ? true : false,\n                    isFeatureEqualToOldHoverFeature_ = activeHoverTextBlockEl_ !== undefined && textblockFeature !== undefined &&\n                    activeHoverTextBlockEl_.getId() === textblockFeature.getId() ? true : false;\n\n                if (!isFeatureEqualToOldHoverFeature_ && !isFeatureEqualSelectFeature_) {\n\n                    // remove old textblock hover features\n                    hoverSourceTextblock_.clear();\n\n                    if (textblockFeature) {\n                        // add textblock feature to hover\n                        hoverSourceTextblock_.addFeature(textblockFeature);\n                    }\n\n                }\n\n                //\n                // Handle TextLine elements\n                //\n                var activeHoverTextBlockEl_ = hoverSourceTextline_.getFeatures().length > 0 ?\n                        hoverSourceTextline_.getFeatures()[0] : undefined,\n                    isFeatureEqualToOldHoverFeature_ = activeHoverTextBlockEl_ !== undefined && textlineFeature !== undefined &&\n                    activeHoverTextBlockEl_.getId() === textlineFeature.getId() ? true : false;\n\n                if (!isFeatureEqualToOldHoverFeature_) {\n\n                    if (activeHoverTextBlockEl_) {\n\n                        // remove highlight effect on fulltext view\n                        var oldTargetElem = $('#' + activeHoverTextBlockEl_.getId());\n\n                        if (oldTargetElem.hasClass('highlight') ) {\n                            oldTargetElem.removeClass('highlight');\n                        }\n\n                        // remove old textline hover features\n                        hoverSourceTextline_.clear();\n\n                    }\n\n                    if (textlineFeature) {\n\n                        // add highlight effect to fulltext view\n                        var targetElem = $('#' + textlineFeature.getId());\n\n                        if (targetElem.length > 0 && !targetElem.hasClass('highlight')) {\n                            targetElem.addClass('highlight');\n                            $('#tx-dlf-fulltextselection').scrollTo(targetElem, 50);\n                            hoverSourceTextline_.addFeature(textlineFeature);\n                        }\n\n                    }\n\n                }\n\n            },\n        this)\n    };\n\n    // add active / deactive behavior in case of click on control\n    var anchorEl = $('#tx-dlf-tools-fulltext');\n    if (anchorEl.length > 0){\n        var toogleFulltext = $.proxy(function(event) {\n        \t  event.preventDefault();\n\n        \t  if ($(event.target).hasClass('active')){\n        \t\t  this.deactivate();\n        \t\t  return;\n        \t  }\n\n        \t  this.activate();\n          }, this);\n\n\n        anchorEl.on('click', toogleFulltext);\n        anchorEl.on('touchstart', toogleFulltext);\n    }\n\n    // set initial title of fulltext element\n    $(\"#tx-dlf-tools-fulltext\")\n    \t.text(this.dic['fulltext-on'])\n    \t.attr('title', this.dic['fulltext-on']);\n\n    // if fulltext is activated via cookie than run activation methode\n    if (dlfUtils.getCookie(\"tx-dlf-pageview-fulltext-select\") == 'enabled') {\n    \t// activate the fulltext behavior\n    \tthis.activate(anchorEl);\n    }\n\n};\n\n/**\n * Activate Fulltext Features\n */\ndlfViewerFullTextControl.prototype.activate = function() {\n\n\tvar controlEl = $('#tx-dlf-tools-fulltext');\n\n\t// if the activate method is called for the first time fetch\n\t// fulltext data from server\n\tif (this.fulltextData_ === undefined)  {\n\t\tthis.fulltextData_ = dlfViewerFullTextControl.fetchFulltextDataFromServer(this.url, this.image);\n\n\t\t// add features to fulltext layer\n\t\tthis.layers_.textblock.getSource().addFeatures(this.fulltextData_.getTextblocks());\n        this.layers_.textline.getSource().addFeatures(this.fulltextData_.getTextlines());\n\n\t    // add first feature of textBlockFeatures to map\n\t    if (this.fulltextData_ !== undefined && this.fulltextData_.getTextblocks().length > 0) {\n\n\t        this.layers_.select.getSource().addFeature(this.fulltextData_.getTextblocks()[0]);\n\t        this.selectedFeature_ = this.fulltextData_.getTextblocks()[0];\n\t        this.showFulltext(this.fulltextData_.getTextblocks());\n\n\t    }\n\t}\n\n\t// now activate the fulltext overlay and map behavior\n    this.enableFulltextSelect();\n    dlfUtils.setCookie(\"tx-dlf-pageview-fulltext-select\", 'enabled');\n    $(controlEl).addClass('active');\n\n    // trigger event\n    $(this).trigger(\"activate-fulltext\", this);\n};\n\n/**\n * Activate Fulltext Features\n */\ndlfViewerFullTextControl.prototype.deactivate = function() {\n\n\tvar controlEl = $('#tx-dlf-tools-fulltext');\n\n\t// deactivate fulltext\n\tthis.disableFulltextSelect();\n    dlfUtils.setCookie(\"tx-dlf-pageview-fulltext-select\", 'disabled');\n    $(controlEl).removeClass('active');\n\n    // trigger event\n    $(this).trigger(\"deactivate-fulltext\", this);\n};\n\n/**\n * Disable Fulltext Features\n *\n * @return\tvoid\n */\ndlfViewerFullTextControl.prototype.disableFulltextSelect = function() {\n\n    // register event listeners\n    this.map.un('click', this.handlers_.mapClick);\n    this.map.un('pointermove', this.handlers_.mapHover);\n\n    // remove layers\n    for (var key in this.layers_) {\n        if (this.layers_.hasOwnProperty(key)) {\n            this.map.removeLayer(this.layers_[key]);\n        }\n    };\n\n    var className = 'fulltext-visible';\n    $(\"#tx-dlf-tools-fulltext\").removeClass(className)\n        .text(this.dic['fulltext-on'])\n        .attr('title', this.dic['fulltext-on']);\n\n    $('#tx-dlf-fulltextselection').removeClass(className);\n    $('#tx-dlf-fulltextselection').hide();\n    $('body').removeClass(className);\n\n};\n\n/**\n * Activate Fulltext Features\n * @param {Array.<ol.Feature>} textBlockFeatures\n * @þaram {Array.<ol.Feature>} textLineFeatures\n */\ndlfViewerFullTextControl.prototype.enableFulltextSelect = function(textBlockFeatures, textLineFeatures) {\n\n    // register event listeners\n    this.map.on('click', this.handlers_.mapClick);\n    this.map.on('pointermove', this.handlers_.mapHover);\n\n    // add layers to map\n    for (var key in this.layers_) {\n        if (this.layers_.hasOwnProperty(key)) {\n            this.map.addLayer(this.layers_[key]);\n        }\n    };\n\n    // show fulltext container\n    var className = 'fulltext-visible';\n    $(\"#tx-dlf-tools-fulltext\").addClass(className)\n      .text(this.dic['fulltext-off'])\n      .attr('title', this.dic['fulltext-off']);\n\n    $('#tx-dlf-fulltextselection').addClass(className);\n    $('#tx-dlf-fulltextselection').show();\n    $('body').addClass(className);\n};\n\n/**\n * Method fetches the fulltext data from the server\n * @param {string} url\n * @param {Object} image\n * @param {number=} opt_offset\n * @return {ol.Feature|undefined}\n * @static\n */\ndlfViewerFullTextControl.fetchFulltextDataFromServer = function(url, image, opt_offset){\n\t  // fetch data from server\n    var request = $.ajax({\n        url: url,\n        async: false\n    });\n\n    // parse alto data\n    var offset = dlfUtils.exists(opt_offset) ? opt_offset : undefined,\n      parser = new dlfAltoParser(image, undefined, undefined, offset),\n    \tfulltextCoordinates = request.responseXML ? parser.parseFeatures(request.responseXML) :\n            request.responseText ? parser.parseFeatures(request.responseText) : [];\n\n    if (fulltextCoordinates.length > 0) {\n        return fulltextCoordinates[0];\n    }\n\n    return undefined;\n};\n\n/**\n * Activate Fulltext Features\n *\n * @param {Array.<ol.Feature>|undefined} features\n */\ndlfViewerFullTextControl.prototype.showFulltext = function(features) {\n\n    var popupHTML = '',\n      /**\n       * Functions wraps fulltext context of a given textblock to a html string\n       * @param {ol.Feature} feature\n       * @return {string}\n       */\n      appendHTML = function(feature) {\n          var html = '',\n            textlines = feature.get('textlines');\n\n          for (var i = 0; i < textlines.length; i++) {\n\n              html = html + '<span class=\"textline\" id=\"' + textlines[i].getId() + '\">';\n\n              var content = textlines[i].get('content');\n              for (var j = 0; j < content.length; j++) {\n                  html = html + '<span class=\"' + content[j].get('type') + '\" id=\"' + content[j].getId()\n                    + '\">' + content[j].get('fulltext').replace(/\\n/g, '<br />') + '</span>';\n              }\n\n              html = html + '</span>';\n          }\n\n          return html;\n      };\n\n    // iterate over given textblocks\n    if (features !== undefined) {\n\n        for (var i = 0; i < features.length; i++) {\n            popupHTML = popupHTML + appendHTML(features[i]) + '<br /><br />';\n        }\n\n    };\n\n    $('#tx-dlf-fulltextselection').html(popupHTML);\n\n};\n"],"sourceRoot":"/home/christopher/IdeaProjects/kitodo-presentation/es6"}